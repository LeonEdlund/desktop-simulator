function Window(){if(this.constructor===Window)throw"Window is an abstract class.";this.element;this.dragHandler}Window.prototype.createWindow=function(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div");c.classList.add(a);d.classList.add(b);e.classList.add("close");d.appendChild(e);c.appendChild(d);this.element=c;this._addListeners(e,d)};
Window.prototype._addListeners=function(a,b){a.addEventListener("click",this.closeWindow.bind(this));this.dragHandler=new DragAndDropHandler(this.element,b)};Window.prototype.appendTo=function(a){a.appendChild(this.element)};Window.prototype.closeWindow=function(){this.element.remove()};function Dice(){this._element;this._amount=Math.floor(6*Math.random())+1}Dice.sides={1:"dice-side-one",2:"dice-side-two",3:"dice-side-three",4:"dice-side-four",5:"dice-side-five",6:"dice-side-six"};Dice.prototype.getScore=function(){return this._amount};Dice.prototype.generateDice=function(){var a=document.createElement("li");a.classList.add("dice");a.classList.add(Dice.sides[this._amount]);return this._element=a};Dice.prototype.delete=function(){this._element.remove()};function Counter(){this.element=document.createElement("ul");this.counterLi=document.createElement("li");this._numbers=[document.createElement("li"),document.createElement("li"),document.createElement("li"),document.createElement("li"),document.createElement("li")];this.counterLi.className="dice-toolbar-counter-wrapper";this._numbers.forEach(function(a){this.counterLi.appendChild(a)});this.element.appendChild(this.counterLi)}
Counter.classNames={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"};Counter.prototype.getCounter=function(){return this.element};Counter.prototype.updateCounter=function(a){a=a.toString().padStart(5,"0");for(var b=0;b<a.length;b++)this._numbers[b].className=Counter.classNames[a[b]]};Counter.prototype.appendTo=function(a){a.appendChild(this.element)};function DiceApplication(a,b){Window.call(this);this._diceContainer;this._allDice=[];this._maxDice=a;this._counter=b;this.createWindow("dice-window-wrapper","dice-menubar-wrapper");this._addToolbar()}DiceApplication.prototype=Object.create(Window.prototype);DiceApplication.prototype.constructor=DiceApplication;DiceApplication.audio=new Audio("/src/wav/add.wav");
DiceApplication.prototype._addToolbar=function(){var a=document.createElement("div"),b=document.createElement("ul"),c=document.createElement("li"),d=document.createElement("li"),e=document.createElement("li"),g=document.createElement("li"),f=document.createElement("div"),h=document.createElement("ul");a.classList.add("dice-toolbar-wrapper");c.classList.add("add");d.classList.add("remove");e.classList.add("roll");f.classList.add("dice-content-wrapper");a.appendChild(b);b.appendChild(c);b.appendChild(d);
b.appendChild(e);b.appendChild(g);g.appendChild(this._counter.getCounter());f.appendChild(h);this.element.appendChild(a);this.element.appendChild(f);this._diceContainer=f;this._addToolbarListeners(c,d,e)};DiceApplication.prototype._addToolbarListeners=function(a,b,c){a.addEventListener("click",this._insertDice.bind(this));b.addEventListener("click",this._removeDice.bind(this));c.addEventListener("click",this._rollAllDice.bind(this))};
DiceApplication.prototype._insertDice=function(){if(!(this._allDice.length>=this._maxDice)){var a=new Dice;this._allDice.push(a);this._diceContainer.appendChild(a.generateDice());this._countScore();DiceApplication.audio.play()}};DiceApplication.prototype._removeDice=function(){0>=this._allDice.length||(this._allDice.pop().delete(),this._countScore(),DiceApplication.audio.play())};
DiceApplication.prototype._rollAllDice=function(){if(!(0>=this._allDice.length)){var a=this._allDice.length;this._allDice=[];DiceApplication.audio.play();this._diceContainer.innerHTML="";for(var b=0;b<a;b++)this._insertDice()}};DiceApplication.prototype._countScore=function(){var a=0;this._allDice.forEach(function(b){a+=b.getScore()});this._counter.updateCounter(a)};var TimeManager=function(){function a(){this.subscribers=[];this.timeAsStrings;this._updateTime();setInterval(this._updateTime.bind(this),1E3)}a.prototype._updateTime=function(){var b=new Date;this.timeAsStrings={hour:b.getHours().toString().padStart(2,"0"),minutes:b.getMinutes().toString().padStart(2,"0"),seconds:b.getSeconds().toString().padStart(2,"0")};this._renderSubscribers()};a.prototype._renderSubscribers=function(){this.subscribers.forEach(function(b){b()})};a.prototype.subscribe=function(b){this.subscribers.push(b);
b()};return{getInstance:function(){void 0===a._instance&&(a._instance=new a);return a._instance}}}();function ClockApplication(){Window.call(this);this.TimeManager=TimeManager.getInstance();this.createWindow("clock-window-wrapper","clock-menubar-wrapper");this._clockContainer=document.createElement("div");this._clockContainer.className="clock-content-wrapper";this._hourDigits=this._createDigits("hour");this._minutesDigits=this._createDigits("minute");this._secondsDigits=this._createDigits("second");this._clockContainer.appendChild(this._hourDigits);this._clockContainer.appendChild(this._minutesDigits);
this._clockContainer.appendChild(this._secondsDigits);this.element.appendChild(this._clockContainer);this.TimeManager.subscribe(this.renderClock.bind(this))}ClockApplication.prototype=Object.create(Window.prototype);ClockApplication.prototype.constructor=ClockApplication;
ClockApplication.prototype.renderClock=function(){var a=this.TimeManager.timeAsStrings,b=a.hour,c=a.minutes;a=a.seconds;this._updateDigits(this._hourDigits,b[0],b[1]);this._updateDigits(this._minutesDigits,c[0],c[1]);this._updateDigits(this._secondsDigits,a.toString()[0],a[1])};
ClockApplication.prototype._createDigits=function(a){var b=document.createElement("ul"),c=document.createElement("li"),d=document.createElement("li");b.classList.add("clock-digit-wrapper",a);c.className="clock-digit-zero";d.className="clock-digit-zero";b.appendChild(c);b.appendChild(d);return b};ClockApplication.prototype._updateDigits=function(a,b,c){a=a.querySelectorAll("li");a[0].classList=this._getNumberClass(b);a[1].classList=this._getNumberClass(c)};
ClockApplication.prototype._getNumberClass=function(a){return{0:"clock-digit-zero",1:"clock-digit-one",2:"clock-digit-two",3:"clock-digit-three",4:"clock-digit-four",5:"clock-digit-five",6:"clock-digit-six",7:"clock-digit-seven",8:"clock-digit-eight",9:"clock-digit-nine"}[a]};function WindowFactory(){}WindowFactory.prototype.createWindow=function(a){var b;"clock"===a?b=new ClockApplication:"dice"===a&&(b=new DiceApplication(40,new Counter));return b};function DragAndDropHandler(a,b){this.element=a;this.grabHandle=b;this.isDragging=!1;this._offsetX;this._offsetY;this.styleConfig={transparent:.5,nonTransparent:1};this._mouseMove=this._mouseMove.bind(this);this._mouseUp=this._mouseUp.bind(this);this.grabHandle.addEventListener("mousedown",this._dragStart.bind(this))}DragAndDropHandler.zIndex=1;
DragAndDropHandler.prototype._dragStart=function(a){this.isDragging=!0;DragAndDropHandler.zIndex++;this.offsetX=a.clientX-this.element.offsetLeft;this.offsetY=a.clientY-this.element.offsetTop;this.element.style.opacity=this.styleConfig.transparent;this.element.style.zIndex=DragAndDropHandler.zIndex;document.addEventListener("mousemove",this._mouseMove);document.addEventListener("mouseup",this._mouseUp)};
DragAndDropHandler.prototype._mouseMove=function(a){if(this.isDragging){var b=a.clientX-this.offsetX;a=a.clientY-this.offsetY;0>b&&(b=0);22>a&&(a=22);this.element.style.left=b+"px";this.element.style.top=a+"px"}};
DragAndDropHandler.prototype._mouseUp=function(a){this.isDragging&&(this.isDragging=!1);this.element.style.opacity=this.styleConfig.nonTransparent;this.element.style.zIndex=this.styleConfig.defaultZIndex;document.removeEventListener("mousemove",this._mouseMove.bind(this));document.removeEventListener("mouseup",this._mouseUp.bind(this))};function App(){this.name="Webbteknik 5 - assignment";this.windowFactory=new WindowFactory}App.prototype.start=function(){var a=document.getElementById("icon-dice"),b=document.getElementById("icon-clock");a.addEventListener("click",this.openDiceWindow.bind(this));b.addEventListener("click",this.openClockWindow.bind(this))};App.prototype.openDiceWindow=function(){this.windowFactory.createWindow("dice").appendTo(document.getElementById("page-content-wrapper"))};App.prototype.openClockWindow=function(){this.windowFactory.createWindow("clock").appendTo(document.getElementById("page-content-wrapper"))};function main(){(new App).start()}window.addEventListener("load",main);